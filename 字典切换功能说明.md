# 字典切换功能说明

## 功能概述

悬浮球翻译工具现已支持字典切换功能，用户可以在三个不同的专业字典之间自由切换，以获得更精确的翻译结果。

## 可用字典

1. **HIS字典** (`his-dict.json`)
   - 医院信息系统相关术语
   - 约43,000+条目
   - 适用于医院管理系统界面

2. **EMR字典** (`emr-dict.json`)
   - 电子病历系统相关术语
   - 约4,000条目
   - 适用于电子病历系统界面

3. **RIS字典** (`ris-dict.json`)
   - 放射信息系统相关术语
   - 约3,500条目
   - 适用于医学影像系统界面

## 使用方法

### 1. 打开字典切换菜单
- 将鼠标悬停在页面右下角的悬浮球翻译工具上
- 菜单会自动展开，显示各种操作选项
- 找到"切换字典 ▶"选项

### 2. 选择字典
- 鼠标悬停在"切换字典 ▶"上
- 子菜单会智能显示在合适的位置（左侧或右侧，避免溢出屏幕）
- 子菜单显示三个字典选项：
  - HIS字典
  - EMR字典  
  - RIS字典
- 当前选中的字典会有蓝色背景高亮和勾选标记(✓)

### 3. 切换字典
- 点击想要切换到的字典选项
- 系统会显示"正在切换字典..."的提示
- 切换成功后显示"字典切换成功: [字典名称] ([条目数]个条目)"
- 菜单自动关闭

### 4. 验证切换结果
- 鼠标悬停在页面元素上，查看翻译结果是否来自新字典
- 可以通过"关于翻译工具"菜单查看当前使用的字典信息

## 技术特性

### 智能定位
- 字典子菜单会根据屏幕空间自动调整显示位置
- 当右侧空间不足时，子菜单会显示在左侧
- 当底部空间不足时，子菜单会向上对齐
- 避免菜单溢出屏幕边界

### 状态保持
- 字典选择会保存到本地存储
- 页面刷新后会自动恢复上次选择的字典
- 不同页面可以使用不同的字典设置

### 实时更新
- 字典切换后立即生效，无需刷新页面
- 主窗口和iframe中的翻译都会使用新字典
- 所有翻译组件（翻译服务、文本段翻译器等）都会同步更新

## 文件修改说明

### 主要修改文件

1. **floating-ball-translator.js**
   - 添加字典配置数组 `availableDictionaries`
   - 添加当前字典状态 `currentDictionary`
   - 实现字典切换子菜单 `createDictionarySubmenu()`
   - 实现智能定位逻辑 `showDictSubmenu()`
   - 实现字典切换功能 `switchDictionary()`
   - 更新状态保存和加载逻辑

2. **content.js**
   - 添加字典更新方法 `updateTranslationDict()`
   - 优化字典加载逻辑，支持从悬浮球获取字典配置
   - 确保所有翻译组件使用统一的字典

3. **manifest.json**
   - 添加EMR和RIS字典文件到web_accessible_resources
   - 确保扩展可以访问所有字典文件

### 测试文件

- **test-dict-switch.html**: 字典切换功能测试页面，包含各字典的测试文本

## 使用注意事项

1. **首次使用**: 默认使用HIS字典，可根据需要切换到其他字典
2. **跨域限制**: iframe中的字典更新可能受跨域限制影响
3. **性能考虑**: 字典文件较大，切换时可能有短暂的加载时间
4. **兼容性**: 功能向后兼容，不影响现有的翻译功能

## 故障排除

### 字典切换失败
- 检查网络连接
- 确认字典文件是否存在
- 查看浏览器控制台是否有错误信息

### 子菜单显示异常
- 刷新页面重试
- 检查是否有其他CSS样式冲突
- 确认浏览器窗口大小是否正常

### 翻译结果未更新
- 确认字典切换成功提示已显示
- 尝试悬停在不同的元素上
- 检查元素文本是否在新字典中存在对应翻译
