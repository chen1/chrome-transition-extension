<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM结构调试测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
        .medType {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            background-color: #f9f9f9;
        }
        .debug-info {
            background-color: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>DOM结构调试测试</h1>
    
    <div class="medType" id="testElement">
        <!-- 国际化原值: HM001707=初诊 -->
        <input name="times" type="radio" id="times1" checked="checked" value="初诊" onclick="checkDtminType()" disabled="disabled">Initial Visit
        <!-- 国际化原值: HM002767=复诊 -->
        <input name="times" type="radio" id="times2" value="复诊" onclick="checkDtminType()" disabled="disabled">Follow-Up Visit
    </div>

    <div class="debug-info" id="debugOutput"></div>

    <script>
        function checkDtminType() {
            console.log('checkDtminType called');
        }
        
        function analyzeDOMStructure() {
            const element = document.getElementById('testElement');
            const debugOutput = document.getElementById('debugOutput');
            
            let output = '=== DOM结构分析 ===\n';
            output += `元素标签: ${element.tagName}\n`;
            output += `元素类名: ${element.className}\n`;
            output += `子节点数量: ${element.childNodes.length}\n\n`;
            
            output += '=== 子节点详情 ===\n';
            for (let i = 0; i < element.childNodes.length; i++) {
                const child = element.childNodes[i];
                output += `子节点 ${i}:\n`;
                output += `  节点类型: ${child.nodeType} (${child.nodeType === Node.TEXT_NODE ? 'TEXT_NODE' : child.nodeType === Node.ELEMENT_NODE ? 'ELEMENT_NODE' : 'OTHER'})\n`;
                output += `  节点名称: ${child.nodeName}\n`;
                output += `  文本内容: "${child.textContent}"\n`;
                output += `  是否有文本内容: ${child.textContent.trim() ? '是' : '否'}\n`;
                if (child.nodeType === Node.ELEMENT_NODE) {
                    output += `  标签名: ${child.tagName}\n`;
                    output += `  属性: ${Array.from(child.attributes).map(attr => `${attr.name}="${attr.value}"`).join(', ')}\n`;
                }
                output += '\n';
            }
            
            output += '=== 混合节点检测 ===\n';
            let hasTextNode = false;
            let hasElementNode = false;
            
            for (let i = 0; i < element.childNodes.length; i++) {
                const child = element.childNodes[i];
                if (child.nodeType === Node.TEXT_NODE && child.textContent.trim()) {
                    hasTextNode = true;
                } else if (child.nodeType === Node.ELEMENT_NODE) {
                    hasElementNode = true;
                }
            }
            
            output += `有文本节点: ${hasTextNode}\n`;
            output += `有元素节点: ${hasElementNode}\n`;
            output += `是混合结构: ${hasTextNode && hasElementNode}\n\n`;
            
            output += '=== TextSegmentTranslator 分析 ===\n';
            if (typeof TextSegmentTranslator !== 'undefined') {
                const translator = new TextSegmentTranslator();
                const segments = translator.analyzeElementStructure(element);
                output += `文本段数量: ${segments.length}\n`;
                segments.forEach((segment, index) => {
                    output += `文本段 ${index}: ${segment.type} - "${segment.text}"\n`;
                });
            } else {
                output += 'TextSegmentTranslator 不可用\n';
            }
            
            debugOutput.textContent = output;
            console.log('DOM结构分析完成');
        }
        
        // 页面加载完成后分析
        document.addEventListener('DOMContentLoaded', analyzeDOMStructure);
        
        // 添加按钮手动触发分析
        const button = document.createElement('button');
        button.textContent = '重新分析DOM结构';
        button.onclick = analyzeDOMStructure;
        document.body.appendChild(button);
    </script>
</body>
</html>
